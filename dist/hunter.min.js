!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.hunter=t()}(this,function(){function e(e,t,r){return e.apply(r,t)}function t(e){return e?c.parse(e):{}}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},c={assignObject:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},stringify:function(e){if(window.JSON&&window.JSON.stringify)return JSON.stringify(e);var t=void 0===e?"undefined":r(e);if("object"!=t||null===e)return"string"==t&&(e='"'+e+'"'),String(e);var n,o,i=[],a=e&&e.constructor==Array,c=arguments.callee;for(n in e)e.hasOwnProperty(n)&&(o=e[n],t=void 0===o?"undefined":r(o),e.hasOwnProperty(n)&&("string"==t?o='"'+o+'"':"object"==t&&null!==o&&(o=c(o)),i.push((a?"":'"'+n+'":')+String(o))));return(a?"[":"{")+String(i)+(a?"]":"}")},parse:function(e){return e="undefined"!=e?e:{},window.JSON&&window.JSON.parse?JSON.parse(e):new Function("return "+e)()},getPlatType:function(){try{return document.createEvent("TouchEvent"),"Mobile"}catch(e){return"PC"}},getSystemInfo:function(){var e=window.screen;return{timestamp:+new Date,projectType:c.getPlatType(),title:document.title,screenSize:e.width+"x"+e.height,referer:document.referrer?document.referrer.toLowerCase():"",project_id:window.hunter_projectId}},typeDecide:function(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"},toArray:function(e){return Array.prototype.slice.call(e)},serializeObj:function(e){var t="";return Object.keys(e).forEach(function(r){c.typeDecide(e[r],"Object")?t+=r+"="+c.stringify(e[r]):t+=r+"="+e[r]+"^"}),encodeURIComponent(t.substr(0,t.length-1))},noop:function(){}},u=function(){function e(t){n(this,e),this.config={localKey:"hunter",url:"http://192.168.19.201:9050/api/error.gif",except:[/^Script error\.?/,/^Javascript error: Script error\.? on line 0/],delay:3e3,repeat:1,validTime:7},this.config=c.assignObject(this.config,t)}return o(e,[{key:"get",value:function(e){return this.config[e]}},{key:"set",value:function(e,t){return this.config[e]=t,this.config[e]}}]),e}(),s={getKey:function(e){var t=function(t){return e[t]};return["msg","colNum","rowNum"].filter(t).map(t).join("@")},getEpires:function(e){return+new Date+864e5*e},getInfo:function(e,t,r){var n=s.getItem(e);if(t){n[s.getKey(t)]={value:t.msg,expiresTime:s.getEpires(r)}}return c.stringify(n)},getItem:function(e){return t(localStorage.getItem(e))},setItem:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return localStorage.setItem(r[0],e(s.getInfo,r,s))},clear:function(e){return e?localStorage.removeItem(e):localStorage.clear()}};return function(e){function t(e){n(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._storeClcikedDom=function(e){var t=e.target?e.target:e.srcElement,n={};if(t&&(t.tagName&&(n.tagName=t.tagName),t.id&&(n.id=t.id),t.className&&(n.className=t.className),t.name&&(n.name=t.name),!t.id)){for(var o=0,i=t;o++<3&&i.parentNode&&i.parentNode.outerHTML&&(i=i.parentNode,!i.id););if(i.id)n.parentId=o+":"+i.id;else{var a=i.outerHTML.replace(/>\s+</g,"><");a&&a.length>200&&(a=a.slice(0,200)),n.outerHTML=a}}r.breadcrumbs.push(n),r.breadcrumbs.length>10&&r.breadcrumbs.shift()},r.breadcrumbs=[],r.rewriteError(),r.rewritePromiseError(),r.catchClickQueue(),r}return i(t,e),o(t,[{key:"rewriteError",value:function(){var e=this,t=arguments;window.onerror||c.noop;window.onerror=function(r,n,o,i,a){i=i||window.event&&window.event.errorCharacter||0;var u=r;u=a&&a.stack?e.handleErrorStack(a):e._fixMsgByCaller(u,t.callee.caller),c.typeDecide(u,"Event")&&(u+=u.type?"--"+u.type+"--"+(u.target?u.target.tagName+"::"+u.target.src:""):""),u&&e.error({msg:u,rowNum:o,colNum:i,targetUrl:n,level:1,breadcrumbs:JSON.stringify(e.breadcrumbs)})}}},{key:"rewritePromiseError",value:function(){var e=this,t=arguments;window.onunhandledrejection||c.noop;window.onunhandledrejection=function(r){var n=r.reason&&r.reason.message||"",o={};r.reason&&r.reason.stack?(n=e.handleErrorStack(r.reason),o=e._parseErrorStack(r.reason.stack)):n=e._fixMsgByCaller(n,t.callee.caller),n&&e.error({msg:n,rowNum:o.line||0,colNum:o.col||0,targetUrl:o.targetUrl||"",level:1,breadcrumbs:JSON.stringify(e.breadcrumbs)})}}},{key:"_fixMsgByCaller",value:function(e,t){for(var r=[],n=t,o=3;n&&o-- >0&&(r.push(n.toString()),n!==n.caller);)n=n.caller;return r.length>0&&(e+="@"+r.join(",")),e}},{key:"_parseErrorStack",value:function(e){var t={},r=e.split("at"),n=r[1].match(/http.*/)[0].replace(/\)$/,""),o=n.split(":"),i=o.length;return t.col=o[i-1],t.line=o[i-2],o.splice(i-2,2),t.targetUrl=o.join(":"),t}},{key:"handleErrorStack",value:function(e){var t=e.stack,r=e.toString();return r?-1===t.indexOf(r)&&(t+="@"+r):t="",t}},{key:"catchClickQueue",value:function(){window.addEventListener?"ontouchstart"in document.documentElement?window.addEventListener("touchstart",this._storeClcikedDom,!0):window.addEventListener("click",this._storeClcikedDom,!0):document.attachEvent("onclick",this._storeClcikedDom)}}]),t}(function(e){return function(e){function t(e){n(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.errorQueue=[],r.repeatList={},r.url=r.config.url+"?err_msg=",["warn","error"].forEach(function(e,t){r[e]=function(e){return r.handle(e,t)}}),r}return i(t,e),o(t,[{key:"request",value:function(e,t){var r=new window.Image;r.onload=t,r.src=e}},{key:"report",value:function(e){var t=this,r=this.errorQueue,n=r.map(function(e){return t.setItem(e),c.stringify(e)}).join("|"),o=this.url+n;return this.request(o,function(){t.removeEpires()}),o}},{key:"repeat",value:function(e){var t=e.rowNum||"",r=e.colNum||"",n=e.msg+t+r;return this.repeatList[n]=this.repeatList[n]?this.repeatList[n]+1:1,this.repeatList[n]>this.config.repeat}},{key:"catchError",value:function(e){return!this.repeat(e)&&(!this.except(e)&&(this.errorQueue.push(e),this.errorQueue))}},{key:"except",value:function(e){var t=this.config.except,r=!1,n=null;if(c.typeDecide(t,"Array"))for(var o=0,i=t.length;o<i;o++)if(n=t[o],c.typeDecide(n,"RegExp")&&n.test(e.msg)||c.typeDecide(n,"Function")&&n(e,e.msg)){r=!0;break}return r}},{key:"send",value:function(e){var t=this,r=e||c.noop,n=this.config.delay;setTimeout(function(){t.report(r)},n)}},{key:"handle",value:function(e,t){if(!e)return!1;if(c.typeDecide(e,"Object")&&!e.msg)return!1;c.typeDecide(e,"Error")&&(e={msg:e.message,ext:{stack:e.stack}});var r=c.typeDecide(e,"Object")?e:{msg:e,level:t};return r=c.assignObject(c.getSystemInfo(),r),this.catchError(r)&&this.send(),r}}]),t}(e)}(function(e){return function(e){function t(e){n(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.setItem(),r}return i(t,e),o(t,[{key:"getItem",value:function(e){return s.getItem(e)}},{key:"setItem",value:function(e){var t=this.config;return s.setItem(t.localKey,e,t.validTime),c.stringify(e)}},{key:"clear",value:function(e){s.clear(e)}},{key:"removeEpires",value:function(){var e=this.config,t=s.getItem(e.localKey)||{},r=+new Date;for(var n in t)t[n].expiresTime<=r&&delete t[n];this.clear(e.localKey);for(var o in t)s.setItem(e.localKey,{msg:t[o].value},e.validTime)}}]),t}(e)}(u)))});
